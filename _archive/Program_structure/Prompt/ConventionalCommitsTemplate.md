### 约定式提交 (Conventional Commits) 格式详解

一个完整的约定式提交信息由三部分组成：**标题 (Header)**、**正文 (Body)** 和 **页脚 (Footer)**。

```
<类型>[可选的作用域]: <简短描述>

[可选的正文]

[可选的页脚]
```

---

#### 1. 标题 (Header) - **必须有**

这是最重要的部分，它用一行总结了这次提交的核心内容。

**格式**: `<type>(<scope>): <subject>`

*   **`type` (类型)**: **必须有**。说明这次提交的类别。常用的类型有：
    *   `feat`: **新功能 (feature)**。这是最重要的类型之一。
    *   `fix`: **修复 Bug**。
    *   `docs`: **只修改了文档** (documentation)。
    *   `style`: 不影响代码含义的修改 (空白、格式化、缺少分号等)。
    *   `refactor`: **代码重构**，既不是修复 Bug 也不是添加新功能。
    *   `test`: 添加或修改测试。
    *   `chore`: **杂务**。构建过程或辅助工具的变动（比如修改配置文件）。
    *   `perf`: 提升性能的修改。

*   **`scope` (作用域)**: **可选**。说明这次提交影响的范围/模块。例如 `(login)`, `(user-profile)`, `(parser)`。

*   **`subject` (简短描述)**: **必须有**。用简洁的语言描述**做了什么**。
    *   使用祈使句，动宾结构，例如“**添加**新功能”，而不是“添加了新功能”。
    *   结尾不加句号。

---

#### 2. 正文 (Body) - **强烈推荐**

这是传递 **“意图 (Intent)”** 的核心区域。

*   与标题之间必须有一个**空行**。
*   详细解释 **“为什么”要做这次修改**，而不仅仅是“做了什么”。
*   可以描述修改前的行为和修改后的行为。
*   可以说明这次修改带来的影响和风险。

---

#### 3. 页脚 (Footer) - **可选**

用于提供一些元信息。

*   与正文之间必须有一个**空行**。
*   **重大变更 (BREAKING CHANGE)**: 如果当前提交引入了不兼容的重大变更，必须以 `BREAKING CHANGE:` 开头，后面详细说明变更内容和迁移方法。这是自动化工具最关心的部分。
*   **关联议题 (Issue Tracking)**: 关闭或关联某个任务管理工具中的议题。例如 `Closes #123`, `Fixes #456`。

---

### 参考示例：你的 Agent 应该生成的 Commit Message

#### 示例 1：一个简单的新功能 (由“需求分析Agent”生成)

假设 Agent A 的任务是根据用户输入，在需求文档中增加一个“邮箱验证”的功能。

```
feat(auth): 增加邮箱验证需求

为了确保用户账户的安全性，并为未来的密码找回功能做准备，本次提交在注册流程中加入了邮箱验证的强制要求。

用户在提供邮箱和密码完成注册后，账户状态应为“待验证”。系统需要向该邮箱发送一封包含验证链接的邮件。用户点击链接后，账户状态才变为“已激活”。
```

**下游 Agent 如何解读？**
*   **标题**: 知道这是一个关于 `auth` 模块的新功能 `feat`。
*   **正文**: 明确了“为什么”（为了安全和密码找回），以及具体的业务逻辑（待验证状态、发送邮件、激活状态），这为“测试用例生成Agent”提供了完美的输入。

#### 示例 2：一次复杂的代码重构并包含重大变更 (由“代码重构Agent”生成)

假设 Agent B 的任务是重构用户模块，并将一个函数改名。

```
refactor(user): 重构用户数据获取逻辑

旧的 `getUserInfo()` 函数承担了过多的职责，既负责从数据库获取数据，又负责格式化数据。本次重构将其拆分为两个独立的函数，以遵循单一职责原则。

- `_fetchUserFromDB()`: 专用于数据库查询。
- `_formatUserData()`: 专用于数据格式化。

这将提升代码的可维护性和可测试性。

BREAKING CHANGE: `getUserInfo()` 函数已被重命名为 `getUserProfile()`。
所有调用旧函数的地方都需要更新。
```

**下游 Agent 如何解读？**
*   **标题**: 知道这是一次对 `user` 模块的 `refactor`。
*   **正文**: 理解了重构的动机和具体实现，可以帮助“文档生成Agent”更新开发者文档。
*   **页脚**: `BREAKING CHANGE` 是一个强烈的信号，可以触发一个自动化流程，去扫描代码库中所有调用 `getUserInfo()` 的地方，并生成一个待办列表给下一个 Agent 或人工开发者。

---

### 总结模板

请让你的第一个任务（生成 Commit Message 的 Agent）严格遵循下面的模板来生成内容。

```
<类型>(<影响的模块>): <一句话总结做了什么>

[空一行]

# 解释为什么需要这次变更
- 变更前的状况是什么？
- 变更后的状况是什么？
- 这次变更是为了解决什么问题或达到什么目的？

[空一行]

# (如果适用) 这是一个重大变更
BREAKING CHANGE: <详细描述不兼容的变更和对下游的影响>

# (如果适用) 关联的任务号
Closes: #<任务ID>
```

只要你的流水线严格遵守这个约定，`git show HEAD` 就能成为一个信息量巨大、上下文完整、意图清晰的“数字信使”，完美地驱动你的自动化开发流程。