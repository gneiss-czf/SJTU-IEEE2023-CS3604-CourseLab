# 测试场景文档

**生成时间：** 2025-01-03
**基于文档：** demo_11.3/.requirements/detailed_requirements.md
**目标Agent：** 测试用例生成Agent
**项目：** 12306火车票预订系统

---

## 用户身份管理模块

### 正常流程测试

#### Scenario: 用户成功注册
```gherkin
Given 用户在注册页面
And 手机号"13800138000"未被注册
When 用户输入手机号"13800138000"、身份证号"110101199001011234"、密码"Test123456"
And 用户输入正确的验证码"123456"
And 用户点击"注册"按钮
Then 系统显示"注册成功"提示
And 用户自动跳转到登录页面
And 数据库中创建新用户记录
```

#### Scenario: 用户成功登录
```gherkin
Given 用户已注册账号"13800138000"
And 用户在登录页面
When 用户输入手机号"13800138000"和正确密码"Test123456"
And 用户点击"登录"按钮
Then 系统验证成功
And 显示"登录成功"提示
And 页面跳转到首页
And 系统生成用户会话Token
```

#### Scenario: 用户成功修改个人信息
```gherkin
Given 用户已登录系统
And 用户在个人信息页面
When 用户修改用户名为"新用户名"
And 用户点击"保存"按钮
Then 系统显示"修改成功"提示
And 页面显示更新后的用户名
And 数据库中用户信息已更新
```

### 异常流程测试

#### Scenario: 手机号格式错误注册
```gherkin
Given 用户在注册页面
When 用户输入手机号"1380013800"（10位数字）
And 用户输入其他必填信息
And 用户点击"注册"按钮
Then 系统显示"手机号格式不正确"错误提示
And 注册按钮保持可点击状态
And 不创建用户记录
```

#### Scenario: 重复手机号注册
```gherkin
Given 手机号"13800138000"已被注册
And 用户在注册页面
When 用户输入已存在的手机号"13800138000"
And 用户输入其他必填信息
And 用户点击"注册"按钮
Then 系统显示"手机号已注册，请直接登录"错误提示
And 提供"去登录"链接
And 不创建重复用户记录
```

#### Scenario: 登录密码错误
```gherkin
Given 用户已注册账号"13800138000"
And 用户在登录页面
When 用户输入手机号"13800138000"和错误密码"WrongPassword"
And 用户点击"登录"按钮
Then 系统显示"用户名或密码错误"提示
And 登录失败次数增加1
And 用户保持未登录状态
```

#### Scenario: 账户锁定
```gherkin
Given 用户已连续登录失败5次
And 用户在登录页面
When 用户再次输入错误密码尝试登录
Then 系统显示"账户已锁定，请30分钟后重试"
And 登录按钮变为不可点击状态
And 账户锁定30分钟
```

### 边界条件测试

#### Scenario: 密码长度边界测试
```gherkin
Given 用户在注册页面
When 用户输入7位密码"Test123"
And 用户输入其他必填信息
And 用户点击"注册"按钮
Then 系统显示"密码至少8位且包含字母数字"错误提示
And 注册失败
```

#### Scenario: Token过期处理
```gherkin
Given 用户已登录系统超过2小时
And 用户Token已过期
When 用户尝试访问需要登录的页面
Then 系统显示"登录已过期，请重新登录"提示
And 自动跳转到登录页面
And 清除本地存储的Token
```

---

## 车票查询模块

### 正常流程测试

#### Scenario: 成功查询车票
```gherkin
Given 用户在车票查询页面
When 用户选择出发地"北京"、目的地"上海"、出发日期"2025-01-10"
And 用户点击"查询"按钮
Then 系统显示符合条件的车次列表
And 显示每个车次的基本信息（车次号、出发时间、到达时间、历时）
And 显示各席别的余票数量和价格
And 查询结果按出发时间排序
```

#### Scenario: 车次筛选功能
```gherkin
Given 用户已查询到车次列表
And 列表中包含高铁、动车、普快等多种车型
When 用户选择筛选条件"仅显示高铁"
And 用户点击"应用筛选"
Then 系统只显示高铁车次
And 更新车次数量统计
And 保持其他查询条件不变
```

#### Scenario: 查看车次详情
```gherkin
Given 用户已查询到车次列表
When 用户点击某个车次的"详情"按钮
Then 系统显示该车次的详细信息
And 显示途经站点和时刻表
And 显示各席别的详细座位分布
And 显示实时余票信息
```

### 异常流程测试

#### Scenario: 查询参数缺失
```gherkin
Given 用户在车票查询页面
When 用户只选择出发地"北京"
And 未选择目的地和出发日期
And 用户点击"查询"按钮
Then 系统显示"请填写完整的查询信息"错误提示
And 高亮显示未填写的必填字段
And 不执行查询操作
```

#### Scenario: 选择过去日期
```gherkin
Given 用户在车票查询页面
And 当前日期为"2025-01-03"
When 用户选择出发日期"2025-01-02"
And 用户填写其他查询条件
And 用户点击"查询"按钮
Then 系统显示"请选择有效的出发日期"错误提示
And 自动将日期重置为当前日期
And 不执行查询操作
```

#### Scenario: 无查询结果
```gherkin
Given 用户在车票查询页面
When 用户选择出发地"北京"、目的地"拉萨"、出发日期"2025-01-10"
And 该路线当日无车次
And 用户点击"查询"按钮
Then 系统显示"暂无符合条件的车次，建议调整查询条件"
And 提供"修改查询条件"建议
And 显示空的查询结果页面
```

### 边界条件测试

#### Scenario: 查询日期上限测试
```gherkin
Given 用户在车票查询页面
And 当前日期为"2025-01-03"
When 用户选择出发日期"2025-02-03"（31天后）
And 用户填写其他查询条件
And 用户点击"查询"按钮
Then 系统显示"最多只能查询30天内的车次"错误提示
And 建议选择30天内的日期
```

#### Scenario: 查询超时处理
```gherkin
Given 用户发起车票查询请求
And 系统查询时间超过10秒
When 查询操作超时
Then 系统显示"查询超时，请稍后重试"提示
And 停止当前查询操作
And 提供"重新查询"按钮
```

---

## 车票预订模块

### 正常流程测试

#### Scenario: 成功预订车票
```gherkin
Given 用户已登录系统
And 用户已查询到有余票的车次"G123"
When 用户选择二等座1张票
And 用户点击"预订"按钮
Then 系统创建预订订单
And 显示"预订成功，请在30分钟内完成支付"提示
And 跳转到订单填写页面
And 座位被临时锁定30分钟
```

#### Scenario: 完成订单填写
```gherkin
Given 用户已成功预订车票
And 用户在订单填写页面
When 用户选择常用乘客"张三"
And 用户填写联系手机号"13800138000"
And 用户点击"提交订单"按钮
Then 系统显示订单详情和应付金额
And 跳转到支付页面
And 订单状态更新为"待支付"
```

#### Scenario: 查看订单列表
```gherkin
Given 用户已登录系统
And 用户有多个历史订单
When 用户访问"我的订单"页面
Then 系统显示用户的所有订单
And 按创建时间倒序排列
And 显示每个订单的状态、车次、金额等信息
And 提供筛选和搜索功能
```

### 异常流程测试

#### Scenario: 未登录预订车票
```gherkin
Given 用户未登录系统
And 用户在车票查询结果页面
When 用户点击某个车次的"预订"按钮
Then 系统显示"请先登录"提示
And 自动跳转到登录页面
And 登录成功后返回预订页面
```

#### Scenario: 余票不足预订
```gherkin
Given 用户已登录系统
And 车次"G123"二等座仅剩1张票
When 用户尝试预订该车次二等座2张票
And 用户点击"预订"按钮
Then 系统显示"该席别余票不足，请选择其他席别"错误提示
And 显示当前可用席别和余票数量
And 不创建预订订单
```

#### Scenario: 订单超时自动取消
```gherkin
Given 用户已预订车票但未支付
And 订单创建时间超过30分钟
When 系统执行定时任务检查订单状态
Then 系统自动取消超时订单
And 释放被锁定的座位
And 发送订单取消通知给用户
And 订单状态更新为"已取消"
```

### 边界条件测试

#### Scenario: 重复预订同一车次
```gherkin
Given 用户已预订车次"G123"且订单未完成
When 用户再次尝试预订同一车次"G123"
And 用户点击"预订"按钮
Then 系统显示"您已预订该车次，请勿重复预订"提示
And 提供"查看已有订单"链接
And 不创建新的预订订单
```

#### Scenario: 预订数量上限测试
```gherkin
Given 用户已登录系统
And 用户尝试预订6张车票
When 用户点击"预订"按钮
Then 系统显示"单次最多只能预订5张车票"错误提示
And 建议分批预订
And 不创建预订订单
```

---

## 乘客信息管理模块

### 正常流程测试

#### Scenario: 成功添加常用乘客
```gherkin
Given 用户已登录系统
And 用户在乘客信息管理页面
When 用户点击"添加乘客"按钮
And 用户输入姓名"李四"、证件类型"身份证"、证件号"110101199002021234"
And 用户选择乘客类型"成人"
And 用户点击"保存"按钮
Then 系统显示"添加成功"提示
And 乘客列表中显示新添加的乘客信息
And 数据库中保存乘客记录
```

#### Scenario: 成功编辑乘客信息
```gherkin
Given 用户已添加常用乘客"李四"
And 用户在乘客信息管理页面
When 用户点击乘客"李四"的"编辑"按钮
And 用户修改姓名为"李四四"
And 用户点击"保存"按钮
Then 系统显示"修改成功"提示
And 乘客列表显示更新后的姓名
And 数据库中乘客信息已更新
```

#### Scenario: 成功删除乘客信息
```gherkin
Given 用户已添加常用乘客"王五"
And 该乘客无关联的未完成订单
And 用户在乘客信息管理页面
When 用户点击乘客"王五"的"删除"按钮
And 用户在确认对话框中点击"确定"
Then 系统显示"删除成功"提示
And 乘客列表中不再显示该乘客
And 数据库中删除乘客记录
```

### 异常流程测试

#### Scenario: 乘客数量超限
```gherkin
Given 用户已添加10个常用乘客
And 用户在乘客信息管理页面
When 用户点击"添加乘客"按钮
And 用户填写新乘客信息
And 用户点击"保存"按钮
Then 系统显示"最多只能添加10个常用乘客"错误提示
And 不保存新乘客信息
And 建议删除不常用的乘客
```

#### Scenario: 证件号格式错误
```gherkin
Given 用户在添加乘客页面
When 用户输入姓名"赵六"、证件类型"身份证"、证件号"12345"（格式错误）
And 用户点击"保存"按钮
Then 系统显示"证件号格式不正确，请重新输入"错误提示
And 高亮显示证件号输入框
And 不保存乘客信息
```

#### Scenario: 删除有关联订单的乘客
```gherkin
Given 用户已添加常用乘客"孙七"
And 该乘客有未完成的订单
When 用户尝试删除乘客"孙七"
And 用户点击"删除"按钮
Then 系统显示"该乘客有未完成订单，暂时无法删除"错误提示
And 提供"查看相关订单"链接
And 不删除乘客信息
```

### 边界条件测试

#### Scenario: 重复添加相同证件号乘客
```gherkin
Given 用户已添加证件号为"110101199003031234"的乘客
When 用户尝试添加相同证件号的新乘客
And 用户点击"保存"按钮
Then 系统显示"该乘客信息已存在，请勿重复添加"错误提示
And 不保存重复的乘客信息
And 显示已存在的乘客信息
```

---

## 系统导航模块

### 正常流程测试

#### Scenario: 首页正常访问
```gherkin
Given 用户打开12306系统
When 用户访问首页
Then 系统显示首页内容
And 显示车票查询入口
And 显示登录/注册入口
And 显示系统公告和服务信息
And 页面加载时间少于3秒
```

#### Scenario: 登录用户首页个性化
```gherkin
Given 用户已登录系统
When 用户访问首页
Then 系统显示个性化欢迎信息
And 显示用户快捷操作菜单
And 显示最近订单信息
And 显示常用路线推荐
```

#### Scenario: 页面间正常跳转
```gherkin
Given 用户在首页
When 用户点击"车票查询"菜单
Then 页面跳转到车票查询页面
And 保持用户登录状态
And 更新浏览器地址栏
And 页面跳转时间少于1秒
```

### 异常流程测试

#### Scenario: 访问不存在页面
```gherkin
Given 用户在系统中
When 用户访问不存在的URL"/nonexistent-page"
Then 系统显示404错误页面
And 提供"返回首页"链接
And 显示友好的错误提示信息
```

#### Scenario: 未登录访问受限页面
```gherkin
Given 用户未登录系统
When 用户尝试访问"我的订单"页面
Then 系统显示"请先登录"提示
And 自动跳转到登录页面
And 登录成功后返回目标页面
```

### 边界条件测试

#### Scenario: 网络连接异常
```gherkin
Given 用户正在使用系统
When 网络连接中断
And 用户尝试进行页面操作
Then 系统显示"网络连接异常，请检查网络设置"提示
And 提供"重试"按钮
And 保存用户当前操作状态
```

---

## 支付处理模块

### 正常流程测试

#### Scenario: 成功发起支付
```gherkin
Given 用户有待支付订单"ORD123456"
And 订单金额为"553.5元"
When 用户选择支付方式"支付宝"
And 用户点击"立即支付"按钮
Then 系统生成支付请求
And 跳转到支付宝支付页面
And 显示正确的订单金额和商品信息
```

#### Scenario: 支付成功处理
```gherkin
Given 用户已发起支付请求
And 用户在第三方支付页面完成支付
When 第三方支付平台返回支付成功通知
Then 系统更新订单状态为"已支付"
And 发送支付成功短信给用户
And 生成电子车票
And 显示支付成功页面
```

#### Scenario: 查看支付记录
```gherkin
Given 用户已完成多笔支付
When 用户访问"支付记录"页面
Then 系统显示所有支付记录
And 按支付时间倒序排列
And 显示支付金额、支付方式、支付状态等信息
And 提供支付凭证下载功能
```

### 异常流程测试

#### Scenario: 支付订单不存在
```gherkin
Given 用户尝试支付已删除的订单
When 用户点击"立即支付"按钮
Then 系统显示"订单不存在或已失效"错误提示
And 跳转到订单列表页面
And 不发起支付请求
```

#### Scenario: 重复支付已支付订单
```gherkin
Given 用户有已支付的订单"ORD123456"
When 用户再次尝试支付该订单
And 用户点击"立即支付"按钮
Then 系统显示"订单已支付，请勿重复支付"提示
And 跳转到订单详情页面
And 显示支付成功状态
```

#### Scenario: 支付超时处理
```gherkin
Given 用户已发起支付请求
And 用户在支付页面停留超过15分钟
When 支付会话超时
Then 系统显示"支付超时，请重新尝试"提示
And 返回订单页面
And 支付请求自动失效
```

### 边界条件测试

#### Scenario: 支付金额为0的订单
```gherkin
Given 用户有使用优惠券后金额为0的订单
When 用户点击"立即支付"按钮
Then 系统自动完成支付流程
And 订单状态直接更新为"已支付"
And 不调用第三方支付接口
And 生成电子车票
```

#### Scenario: 支付系统维护
```gherkin
Given 支付系统正在维护
When 用户尝试发起支付
And 用户点击"立即支付"按钮
Then 系统显示"支付系统维护中，请稍后重试"提示
And 显示预计维护结束时间
And 提供"稍后支付"选项
```